<div id="materials-table">
    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; border-radius: 8px;">
        <label>
            <input type="checkbox" name="critical_only" value="true"
                hx-get="/materials/list" 
                hx-target="#materials-table" 
                hx-include="[name='order_by_inventory'], [name='desc'], [name='inactive']"
                {% if critical_only %}checked{% endif %}> 
            ‚ö†Ô∏è Solo Cr√≠ticos
        </label>
        <label>
            <input type="checkbox" name="order_by_inventory" value="true"
                hx-get="/materials/list" 
                hx-target="#materials-table" 
                hx-include="[name='critical_only'], [name='desc'], [name='inactive']"
                {% if order_by_inventory %}checked{% endif %}> 
            üìä Ordenar Stock
        </label>
        <label>
            <input type="checkbox" name="inactive" value="true"
                hx-get="/materials/list" 
                hx-target="#materials-table" 
                hx-include="[name='critical_only'], [name='order_by_inventory'], [name='desc']"
                {% if inactive %}checked{% endif %}> 
            üö´ Solo Inactivos
        </label>
        <label style="{% if not (critical_only or order_by_inventory) %}opacity: 0.5; cursor: not-allowed;{% endif %}">
            <input type="checkbox" name="desc" value="true"
                hx-get="/materials/list" 
                hx-target="#materials-table" 
                hx-include="this, [name='critical_only'], [name='order_by_inventory'], [name='inactive']"
                {% if not (critical_only or order_by_inventory) %}disabled{% endif %}
                {% if desc %}checked{% endif %}> 
            ‚¨áÔ∏è Descendente
        </label>
    </div>
    {% if materials|length == 0 %}
        <p>No materials found.</p>
    {% endif %}
    <table class="striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Image</th>
                <th>Name</th>
                <th>SKU</th>
                <th>Unit</th>
                <th>Quantity Available</th>
                <th>Status</th>
                <th>Active</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for material in materials %}
            <tr>
                <td>{{ material.id }}</td>
                <td>
                    {% if material.image_url %}
                        <img src="{{ material.image_url }}" alt="{{ material.name }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                    {% else %}
                        <span style="font-size: 30px;">üì¶</span>
                    {% endif %}
                </td>
                <td>{{ material.name }}</td>
                <td><code>{{ material.sku }}</code></td>
                <td>{{ material.unit_measure }}</td>
                <td>{{ material.inventory.quantity_available if material.inventory else 'N/A' }}</td>
                <td>{{ 'Critical' if material.inventory and material.inventory.quantity_available <= material.critical_threshold else 'Normal' }}</td>
                <td>{{ 'Yes' if material.is_active else 'No' }}</td>
                <td>
                    <div class="actions">
                        <button
                            hx-get="/materials/{{ material.id }}/edit"
                            hx-target="#modal-content"
                            hx-swap="innerHTML"
                            onclick="document.getElementById('modal').style.display='block'"
                            >
                            Edit
                        </button>
                        <button class="secondary" 
                            hx-delete="/materials/{{ material.id }}" 
                            hx-target="#materials-table" 
                            hx-swap="innerHTML" 
                            hx-confirm="Are you sure you want to delete {{ material.name }}? This action cannot be undone and the associated inventory will be deleted."
                            >
                            Delete
                        </button>
                        <button
                            hx-get="/materials/{{ material.id }}/movement"
                            hx-target="#modal-content"
                            hx-swap="innerHTML"
                            onclick="document.getElementById('modal').style.display='block'"
                            >
                            Create Movement
                        </button>
                        {% if user.role.value == 'plant_manager' %}
                            <button
                                hx-get="/materials/{{ material.id }}/adjustment"
                                hx-target="#modal-content"
                                hx-swap="innerHTML"
                                onclick="document.getElementById('modal').style.display='block'"
                                >
                                Threshold Adjustment
                            </button>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <nav>
    {% if page > 1 %}
    <a hx-get="/materials/list?page={{ page - 1 }}"
       hx-target="#materials-table"
       hx-swap="innerHTML">
        Back
    </a>
    {% endif %}
    
    <span>Page {{ page }} of {{ total_pages }}</span>
    
    {% if page < total_pages %}
    <a hx-get="/materials/list?page={{ page + 1 }}"
       hx-target="#materials-table"
       hx-swap="innerHTML">
        Next
    </a>
    {% endif %}
    </nav>
    <a href="/dashboard">Back</a>
</div>